# 优化报告

观察到对于每个点的计算都是相对独立的，可以多线程。

具体地，我使用了 8 个线程，把 height 行平均分给这 8 个线程计算。因为不存在资源抢占，所以也不需要加锁。跑出来运行时间大约是原来的 1/3。

优化后：

```
Edge detection with a 3x3 stencil

Image size: 10410 x 5905

Trial        Time, ms 
    1          65.142 
    2          64.494 
    3          64.960 
    4          63.790 
    5          63.293 
    6          63.184 
    7          63.231 
    8          63.148 
    9          63.568 
   10          63.869 
-----------------------------------------------------
Total :      638.7 ms
-----------------------------------------------------
```

优化前：

```
Edge detection with a 3x3 stencil

Image size: 10410 x 5905

Trial        Time, ms 
    1         191.108 
    2         191.394 
    3         192.031 
    4         192.513 
    5         191.684 
    6         191.176 
    7         191.423 
    8         191.734 
    9         191.467 
   10         191.107 
-----------------------------------------------------
Total :     1915.6 ms
-----------------------------------------------------
```

优化后输出：

![img](stencil/output.png)

优化前输出：

![img](stencil/baseline/output.png)

